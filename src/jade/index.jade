include mixins

doctype html
html(ng-app='mainApp')
	head
		meta(charset='UTF-8')
		meta(name='description', content='Some have suggested that this game is similar to the card game "Splendor" by Space Cowboys.')
		meta(name='author', content='Moritz Company')
		meta(name='viewport', content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no')
		meta(name='apple-mobile-web-app-capable' content='yes')
		meta(name='apple-touch-fullscreen' content='yes')
		title Explorers
		link(rel='shortcut icon', href='favicon.ico')
		link(rel='stylesheet', href='inc/main.css')
		script(src='inc/angular.js')
	body(ng-cloak, ng-controller='MainCtrl')
		.container(ng-class='gameStatus' ng-mousemove='moveCursor($event)')
			img#cursor.img.img-responsive(src='img/hand.png' ng-style='activeGame.cursor' ng-hide='currentUser.uid == currentPlayer.uid')
			header.hide
				h1 Explorers
			.jumbotron
				h2.text-center Welcome to Explorers!
				div(ng-hide='currentUser')
					button.btn.btn-primary.btn-lg.facebook-login(ng-click='fbLogin()') Login with Facebook
				h4(ng-show='currentPlayer') Active Player: {{currentPlayer.name}}
				.notices
			ul.map
				li.space(ng-repeat='space in map track by $index' class='{{space.terrain}} {{space.special}}')
			.pre-game.row(ng-show='currentUser.uid && !activeGame')
				+col(6)
					h3 Choose a game:
					ul
						li.btn.btn-info(ng-show='currentUser' ng-repeat='game in allGames track by $index' ng-click='joinActiveGame(game)') {{game.id}}: {{game.name}}
					h3 Or create a new one:
					.btn.btn-success(ng-click='createNewGame()') Create new game
				+col(6)
					h3 Message List:
					ul
						li(ng-repeat='message in chatList track by $index') {{message.user}}: {{message.text}}
					form(name='chatWindow' ng-submit='submitChat()')
						input(ng-model='ff.chat' placeholder='respond to chat')
						button(ng-hide='true' type='submit')
			.pre-game.row(ng-show='activeGame && !currentPlayer')
				+col(6)
					h3 Players:
					ul
						li(ng-repeat='player in activeGame.playerIds track by $index') {{player}}
					button.btn.btn-success(ng-click='startGame()') Start the game
			.game-started.row(ng-show='currentPlayer')
				+col(6)
					button.btn.btn-success(ng-click='changeCurrentPlayer()' ng-disabled='!currentPlayer.takenMainAction') End Turn
					button.btn.btn-warning(ng-click='currentPlayer.camp()' ng-disabled='!currentPlayer.notCamped') Camp
					h4 All Players
					ul.players
						li(ng-repeat='player in allPlayers')
							h5(ng-click='changeCurrentPlayer(player)' style='background-color:{{player.color}}')
								span.badge {{player.idx}}
								| {{player.name}}
								i.sprite.symbol(ng-repeat='card in player.deck.playedCards track by card.id' class='{{card.symbol}}')
							h6 Supplies:
							ul
								li(ng-repeat='boat in player.corp.supplyBoats') Cost: {{boat.cost()}} Size: {{boat.content.length}}
									ul
										li(ng-repeat='item in boat.content track by $index' class='text-{{item.btnClass}}') {{item.display}}
											i.sprite(class='{{item.name}}')
							h6 Indians:
							ul
								li(ng-repeat='boat in player.corp.indianBoats') Cost: {{boat.cost()}} Size: {{boat.content.length}}
							div(ng-if='player.tiles.length')
								h6(ng-repeat="(key, value) in player.tiles") Tile: #[span.capitalize {{key}}] {{value.length > 1 ? "(" + value.length + ")" : ""}}
							div(ng-if='player.cards.length')
								h6(ng-repeat="(key, value) in player.cards | groupBy: 'gem'") Card: #[span.capitalize {{key}}] {{value.length > 1 ? "(" + value.length + ")" : ""}}
							div(ng-if='player.chips.length')
								h6(ng-repeat="(key, value) in player.chips | groupBy: 'gem'") Gem: #[span.capitalize {{key}}] {{value.length > 1 ? "(" + value.length + ")" : ""}}
							div(ng-if='player.reserve.length')
								button.btn.btn-info(ng-click='toggleReserve(player)') {{player.showReserve ? 'Hide' : 'Show'}} Reserve
								ul.track.player(ng-show='player.showReserve')
									li.card(ng-repeat='card in player.reserve' ng-class='card.gem' ng-click='collectReserveCard(player, card)')
										h5.hidden Id: {{card.id}}
										h4.capitalize {{card.gem}}
										h5 Points: {{card.points}}
										h5 Cost:
										ul.cost
											li(ng-repeat='(gem, value) in card.cost' ng-class='gem' ng-show='value > 0')
												p {{value}}
				+col(6)
					h3 {{currentPlayer.name}} Cards in Hand
					ul
						li.held-card(ng-repeat='card in currentPlayer.deck.heldCards track by card.id' class='{{card.symbol}}' ng-click='callPlayCard(card)')
							p
								span.badge {{card.strength}}
								|  {{card.name}}
								i.sprite.symbol(class='{{card.symbol}}')
							ul
								li.ability(ng-repeat='ability in card.ability track by $index')
									p Cost: {{ability.cost}}
									p Benefit: {{ability.benefit}}
					h3 {{currentPlayer.name}} Cards in Play
					ul
						li.played-card(ng-repeat='card in currentPlayer.deck.playedCards track by card.id' class='{{card.symbol}}')
							p
								span.badge {{card.strength}}
								| {{card.name}}
								i.sprite.symbol(class='{{card.symbol}}')
							//- ul
								li.ability(ng-repeat='ability in card.ability track by $index')
									p Cost: {{ability.cost}}
									p Benefit: {{ability.benefit}}
		script(src='inc/lib.js')
		script(src='inc/main.js')
		script#strengthModal(type='text/ng-template')
			.modal-header
				h3 Total Strength: {{currentPlayer.playStrength}}; Used: {{currentPlayer.deck.activeCard.plays}}
			.modal-body.row
				+col(null, 8, 8)
					ul
					li.held-card.pointer(ng-repeat='card in currentPlayer.deck.heldCards track by card.id' class='{{card.symbol}}' ng-click='addStrength(card)')
						p
							span.badge {{card.strength}}
							|  {{card.name}}
							i.sprite.symbol(class='{{card.symbol}}')
					.btn.btn-danger(ng-click='playIndian()') Add Indian
						span.badge  {{currentPlayer.indianCount}}
				+col(null, 4, 4)
					li.held-card(class='{{currentPlayer.deck.activeCard.symbol}}')
						h3
							i.sprite.symbol(class='{{currentPlayer.deck.activeCard.symbol}}')
							| {{currentPlayer.deck.activeCard.name}}
						ul
							li.ability.pointer(ng-repeat='ability in currentPlayer.deck.activeCard.ability track by $index' ng-click='currentPlayer.useAbility(ability)')
								p Cost: {{ability.cost}}
								p Benefit: {{ability.benefit}}
//		| @@javascriptReplaceFiles
